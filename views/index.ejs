<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <style type="text/css">
    .aceable {
       height: 200px;
       margin-bottom:10px;
    }
    </style>
    <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
    <script src="http://simplewebrtc.com/latest.js"></script>
    <script src="/javascripts/ace.js" type="text/javascript" charset="utf-8"></script>
    <script src="/javascripts/socket.io.js" type="text/javascript"></script>
  </head>
  <body>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>

   <div class="aceable" id="editor">function foo(items) {
       var x = "All this is syntax highlighted";
       return x;
   }</div>
   <div class="aceable"> function foo(){}</div>
       
   <script>
       var socket = io.connect(window.location.origin);
       var locks = {};
       var editors = {};
       $('.aceable').each(function(k,v) {
          var editor = ace.edit(v);
          var session = editor.getSession();
          editors[k] = {locked: false, session: session};
          editor.setTheme("ace/theme/monokai");
          session.setMode("ace/mode/javascript");
          session.on('change', function(d,e,f) {
             if (!editors[k].locked) {
                socket.emit('text-changed', {id: k, value:session.getValue()});
             }
          });
       });

       socket.on('update-text', function(d) {
          var editor = editors[d.id];
          editor.locked = true;
          editor.session.setValue(d.value);
          editor.locked = false;
       });
   </script>
  </body>
</html>
